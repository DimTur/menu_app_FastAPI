
<details>
<summary><b>Что было реализовано в проекте:</b></summary>

1. Фреймворки, БД и ORM.

Написать проект на FastAPI с использованием PostgreSQL в качестве БД. В проекте следует реализовать REST API по работе с меню ресторана, все CRUD операции. Для проверки задания, к презентаций будет приложена Postman коллекция с тестами. Задание выполнено, если все тесты проходят успешно.
Даны 3 сущности: Меню, Подменю, Блюдо.

Зависимости:

- У меню есть подменю, которые к ней привязаны.

- У подменю есть блюда.

Условия:

- Блюдо не может быть привязано напрямую к меню, минуя подменю.
- Блюдо не может находиться в 2-х подменю одновременно.
- Подменю не может находиться в 2-х меню одновременно.
- Если удалить меню, должны удалиться все подменю и блюда этого меню.
- Если удалить подменю, должны удалиться все блюда этого подменю.
- Цены блюд выводить с округлением до 2 знаков после запятой.
- Во время выдачи списка меню, для каждого меню добавлять кол-во подменю и блюд в этом меню.
- Во время выдачи списка подменю, для каждого подменю добавлять кол-во блюд в этом подменю.
- Во время запуска тестового сценария БД должна быть пуста.

2. Docker, Тестирование

В этом задании надо написать тесты для ранее разработанных ендпоинтов вашего API после Вебинара №1.

Обернуть программные компоненты в контейнеры. Контейнеры должны запускаться по одной команде “docker-compose up -d” или той которая описана вами в readme.md.

Образы для Docker:
(API) python:3.10-slim
(DB) postgres:15.1-alpine

- Написать CRUD тесты для ранее разработанного API с помощью библиотеки pytest
- Подготовить отдельный контейнер для запуска тестов. Команду для запуска указать в README.md
- *Реализовать вывод количества подменю и блюд для Меню через один (сложный) ORM запрос.
- **Реализовать тестовый сценарий «Проверка кол-ва блюд и подменю в меню» из Postman с помощью pytest. Тесты асинхронные.

3. Паттерны и принципы разработки

- Вынести бизнес логику и запросы в БД в отдельные слои приложения.

- Добавить кэширование запросов к API с использованием Redis. Не забыть про инвалидацию кэша.

- Добавить pre-commit хуки в проект. Файл yaml будет прикреплен к ДЗ.

- Покрыть проект type hints (тайпхинтами)

- *Описать ручки API в соответствий c OpenAPI

- **Реализовать в тестах аналог Django reverse() для FastAPI

Требования:
- Код должен проходить все линтеры.
- Код должен соответствовать принципам SOLID, DRY, KISS.
- Проект должен запускаться по одной команде (докер).
- Проект должен проходить все Postman тесты (коллекция с Вебинара №1).
- Тесты написанные вами после Вебинара №2, должны быть актуальны, запускать и успешно проходить

Дополнительно:
Контейнеры с проектом и с тестами запускаются разными командами.

4. Многопроцессорность, асинхронность

- Переписать текущее FastAPI приложение на асинхронное выполнение
- Добавить в проект фоновую задачу с помощью Celery + RabbitMQ.
- Добавить эндпоинт (GET) для вывода всех меню со всеми связанными подменю и со всеми связанными блюдами.
- Реализовать инвалидация кэша в background task (встроено в FastAPI)
- *Обновление меню из файла Menu.xlsx раз в 15 сек.
- ** Блюда по акции. Размер скидки (%) указывается в столбце G файла Menu.xlsx

Фоновая задача: синхронизация Excel документа и БД.
   В проекте есть папка admin. В этой папке файл Menu.xlsx.
   При внесении изменений в файл все изменения должны отображаться в БД. Периодичность обновления 15 сек. Удалять БД при каждом обновлении – нельзя.

</details>

## Запуск приложения

**1. Клонируем репозиторий:**

    git clone https://github.com/DimTur/menu_app_FastApi.git

**2. Перейти в папку /menu_app_FastApi**

**3. Поднимаем docker comopose в фоновом режиме**

    docker compose up -d

**4. Пользуемся приложением по адресу http://127.0.0.1:8000/docs**

**5. Чтобы остановить работу контейнеров вводим команду:**

    docker compose down

**Однако, рекомендуется прекращать работу контейнеров с удалением томов, команда:**

    docker compose down -v

## Запуск приложения с прохождением тестов

Для прогона тестов необходимо убедиться, что Вы выполнили команду "docker compose down -v" для
корректного запуска тестового сценария. Также очень важно убедиться, что у вас отсутствуют образы и кэш с предыдущих сборок!!!

Чтобы запустить тестовый сценарий, введите команду, представленную ниже. Она создаст нужные контейнеры,
прогонит написанные мной тесты, выведет результаты в консоль, после чего остановит зупущенные сервисы, удалит
контейнеры, тома и образы, которые использовались

    docker compose -f docker-compose-pytest.yml up -d && docker logs --follow menu_app_fastapi_test && docker compose -f docker-compose-pytest.yml down -v

**3-ий пункт ДЗ реализован в api_v1.munus.crud в функциях "get_menus" и  "get_menu_by_id", аналогично в submenus**
